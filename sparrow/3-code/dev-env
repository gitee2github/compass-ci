#!/usr/bin/env bash
# SPDX-License-Identifier: MulanPSL-2.0+

server_name=$(hostname | cut -f1 -d.)
server_ip=$(ip route get 1.2.3.4 | awk '{print $7; exit}')

mkdir -p /etc/crystal-ci/defaults
cat > /etc/crystal-ci/defaults/$server_name.yaml <<EOF
SCHED_HOST: $server_ip
SCHED_PORT: 3000
OS_HTTP_HOST: $os_http_host
INITRD_HTTP_HOST: $initrd_http_host
INITRD_HTTP_PORT: $initrd_http_port
EOF

cat > /etc/profile.d/crystal.sh <<'EOF'
export LKP_SRC=/c/lkp-tests
export CCI_SRC=/c/crystal-ci

export PATH="$PATH:$CCI_SRC/sbin:$LKP_SRC/sbin:$LKP_SRC/bin"
EOF

