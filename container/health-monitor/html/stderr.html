<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Standard Error</title>
</head>

<body onload="onload()">

    <h1 style="text-align:center">Compass CI active stderrs</h1>
    <hr>
    <div style="width:90%;margin:auto">
        <label>total lines : </label>
        <label id="lines">0</label>
        <table id="stderrs" style="width:100%;word-break:break-all;" border="1">
            <th width=5%>count</th>
            <th width=10%>first_date</th>
            <th width=10%>suite</th>
            <th width=10%>job_owner</th>
            <th width=10%>relevant_links</th>
            <th width=55%>error_message</th>
        </table>
    </div>

</body>
<script>
    function getdata() {
        var ajax = new XMLHttpRequest();
        ajax.open("post", "/active_stderr");
        ajax.send();
        ajax.onreadystatechange = function () {
            if (ajax.readyState == 4 && ajax.status == 200) {
                var data = JSON.parse(ajax.responseText);
                document.getElementById('lines').innerText = data.total;
                showData(data.data, 'stderrs');
            }
        }
    };

    function showData(data, tbid) {
        for (var i = 0; i < data.length; i++) {
            var tr = document.createElement('tr');
            document.getElementById(tbid).appendChild(tr);

            var td = document.createElement('td');
            tr.appendChild(td);
            td.style.textAlign = 'center';
            td.innerText = data[i].count;

            var td = document.createElement('td');
            td.style.textAlign = 'center';
            tr.appendChild(td);
            td.innerText = data[i].first_date;

            var td = document.createElement('td');
            td.style.textAlign = 'center';
            tr.appendChild(td);
            td.innerText = data[i].suite;

            var td = document.createElement('td');
            td.style.textAlign = 'center';
            tr.appendChild(td);
            td.innerText = data[i].job_owner;

            var td = document.createElement('td');
            td.style.textAlign = 'center';
            tr.appendChild(td);
            var a = document.createElement('a');
            td.appendChild(a);
            var s_link = data[i]['relevant_links'].split('/');
            a.innerText = s_link[s_link.length - 1];
            a.href = data[i]['relevant_links'];
            a.target = '_blank';

            var td = document.createElement('td');
            tr.appendChild(td);
            td.innerText = data[i].error_message;
        }
    };

    function onload() {
        getdata();
    };
</script>

</html>
